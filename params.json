{
  "name": "Newproj",
  "tagline": "",
  "body": "---\r\ntitle: 'Saigas on the brink: multi-disciplinary analysis of the factors influencing\r\n  a mass die-off event'\r\nauthor: \"Many et al. with loads of work from Sarah\"\r\ndate: \"14 October 2016\"\r\noutput: html_document\r\n---\r\n\r\n### Saiga antelope calving sites/ Die-off sites analyses\r\n\r\n* 1. Question - To identify the variables separating the Saiga die-off sites from random sites\r\n\r\n```{r,include=FALSE}\r\nlibrary(raster)\r\nlibrary(sp)\r\nlibrary(ggmap)\r\nlibrary(FactoMineR)\r\nlibrary(reshape2)\r\nlibrary(rstan)\r\nlibrary(brms)\r\nlibrary(corrplot)\r\nlibrary(shinystan)\r\n```\r\n\r\nReading Dataset file\r\n\r\n```{r}\r\ndataset<-read.csv(\"DATA_WIDE_79_16_MED.csv\",h=T)\r\n#names(dataset)\r\ncalving<-SpatialPointsDataFrame(dataset[,c(\"LON\",\"LAT\")],data=dataset)\r\ncalvingbox<-bbox(calving)\r\ncmap<-get_map(calvingbox,zoom=6,maptype=\"terrain\")\r\n```\r\n\r\n#### Locations of Normal calving sites and Dieoff sites\r\n```{r}\r\nmap1<-ggmap(cmap)+\r\ngeom_point(data=dataset,aes(x=LON,y=LAT,color=Dieoff,size=2))+\r\nggtitle(\"Calving sites\")+theme_bw()\r\nmap1\r\n```\r\n\r\nConverting variables\r\n```{r}\r\ndataset$Year<-as.factor(dataset$Year)\r\ndataset$Dieoff<-as.numeric(dataset$Dieoff)\r\n```\r\n\r\n\r\n#### Using the Bayesian Hierarchical Modelling\r\n\r\n\r\n##### Sarah's comments\r\nI think it is best to start with mean maximum daily humidity dewpoint over 5 days to onset/9 May, mean minimum daily temperatures over 5 days to onset, total precipitation  over 5 days to onset and number of days with precipitation over 10 days to onset.  Some of these are related and will be eventually removed, but they are the ones which look important and fit in with our hypotheses.\r\n\r\n#### Selected variables are\r\n* 1. mean maximum daily humidity dewpoint over 5 days to onset/9 May, \r\n* 2. mean minimum daily temperatures over 5 days to onset, \r\n* 3. total precipitation  over 5 days to onset and \r\n* 4. number of days with precipitation over 10 days to onset\r\n\r\n```{r,message=FALSE, warning=FALSE}\r\n#mod.hum.temp<-brm(formula=Dieoff ~ AVRHUMID_MAX5D+AVOFMINTEMP_5D+GCPP_PRECIP_5D+PRECIPDAYS_10D+LAT+LON+(1|Year), data = dataset, \r\n#                  family = bernoulli(link = \"logit\"), \r\n#                  autocor=cor_arma(formula = ~Year),\r\n#    prior = c(set_prior(\"normal(0,10)\", class = \"b\")), \r\n#    warmup = 1000, iter = 2000, chains = 4,\r\n#    control = list(adapt_delta = 0.95),verbose=FALSE)\r\n#summary(mod.hum.temp)\r\n#plot(mod.hum.temp)\r\n#launch_shiny(mod.hum.temp) \r\n#marginal_effects(mod.hum.temp)\r\n```\r\n\r\nModel selection using Watanbe's infromation\r\n\r\n```{r}\r\n#WAIC(mod.hum.temp)\r\n```\r\n\r\n#### Results \r\n\r\nSo the above analyses (see summary above) hints towards , at die-off sites, **higher mean minimum daily temperatures over 5 days to onset, and higher number of days with precipitation over 10 days to onset**. This is indicated by hgh Estimate values (13.4 and 14.3) for these variables in the model and also that their l-95% and u-95% limits do not overlap 0. The rest of the variables are not really important.\r\n\r\nNote that this model **includes the temporal autocorrelation and a random effect of year**. It **accounts for the spatial trend by having LAT and LON variables in the model**, although they dont seem to have a large impact. The **use of strong priors attempts to overcome the issue of perfect separation** that the model forces to sample and resample through the observed values. However, we may try to have **specific priors to the variable of interest** , for e.g. Min Temp. or Precipitation here, and we can then work it out for the variables we select eventually.\r\n\r\nThe next step is to accomodate the nearest neighbour matrix for the neighbourhood structure to account for spatial autocorrelation and see if the model estimates improve. \r\n\r\n#### Plotting spatial locations of Dieoff on google map\r\n```{r}\r\nmap2<-ggmap(cmap)+\r\ngeom_point(data=dataset,aes(x=LON,y=LAT),size=2)+ggtitle(\"Calving sites\")+\r\ntheme_bw()\r\nmap2+facet_wrap(~Dieoff)\r\n```\r\n\r\n##### Other variables to test\r\nNDVI anomaly \r\n(sd x100)\r\n\t3rd week April\r\nPrecipitation (ERA)\tNumber of days \r\nPrecipitation (ERA)\tTotal (mm)\r\nPrecipitation (GPCC)\tTotal (mm)\r\nDewpoint temperature\tMean of daily maxima (°C)\r\nRelative humidity\tMaximum (%)\r\nRelative humidity\tMean of daily maxima (%)\r\nSnow anomaly\r\n(1- probability of snow, multiplied x 10000)\r\n\t1st week April\r\n\t2nd  week April\r\n\t4th week March\r\nSnow cover days \tNumber of days from 1 Jan \r\nSoil water\tMaximum of daily means\r\nTemperature\tAverage daily mean (°C)\r\nTemperature\tAverage daily maximum (°C)\r\nTemperature\tAverage daily minimum (°C)\r\nTemperature\tMinimum (°C)\r\nTemperature difference\tTotal variation over 5 days\r\nTemperature difference\tDifference in daily minima\r\nWindgust\tAverage daily m/s\r\n\r\n#### Selecting variables\r\n```{r}\r\nseldat<-dataset[,c(\"Dieoff\",\"LAT\",\"LON\",\"Year\",\"AVRHUMID_MAX5D\",\"MAXRHUMID_MEAN5D\",\"AVOFMINTEMP_5D_STGN\",\"DEWPAVMX_3D\",\"MINTEMP_0D\",\"MINTEMP_5D\",\"TOTPRECIP_5D\",\"TOTPRECIP_10D\",\"PRECIPDAYS_5D\",\"PRECIPDAYS_10D\",\"MINTEMP_5D\",\"AVOFMINTEMP_10D\",\"AVOFMINTEMP_5D\",\"DEWPAVMX_5D\",\"MAXRHUMID_MEAN10D\",\"MAXRHUMID_MEAN5D\",\"DIFFTEMP_3DAY\",\"SNOWANOM_MEAN_APRW1\",\"NDVIANOM_MEAN_APRW3\")]\r\n```\r\n\r\n#### Conducting a PCA\r\n```{r}\r\nseldat<-seldat[complete.cases(seldat),]\r\nseldat2<-seldat[c(\"AVRHUMID_MAX5D\",\"DEWPAVMX_3D\",\"TOTPRECIP_5D\",\"MINTEMP_5D\",\"DIFFTEMP_3DAY\",\"SNOWANOM_MEAN_APRW1\")]\r\nall.pca<-PCA(seldat2)\r\n#all.pca<-PCA(seldat[,c(5:23)])\r\nall.pca$var$contrib\r\nall.pca$eig\r\n```\r\n\r\n#### Plotting data\r\n\r\n```{r}\r\nseldat$Dieoff<-as.factor(seldat$Dieoff)\r\ndf.m <- melt(seldat, id.var = \"Dieoff\")\r\ndf.m$value<-as.numeric(df.m$value)\r\n```\r\n\r\n```{r,fig.width = 10, fig.height = 10}\r\np <- ggplot(data = df.m, aes(x=variable, y=value)) + \r\n             geom_boxplot(aes(fill=Dieoff))+\r\n  theme_bw()\r\np + facet_wrap( ~ variable, scales=\"free\")\r\n```\r\n\r\n\r\n#### Correlation Matrix\r\n```{r,fig.width = 8, fig.height = 8}\r\n#ctab <- cor(seldat[,c(5:23)])\r\nctab2 <- cor(seldat2)\r\n#round(ctab, 2)\r\ncorrplot(ctab2, type = \"upper\", order = \"hclust\", \r\n         tl.col = \"black\", tl.srt = 45)\r\n```\r\n\r\n#### Constructing a full model\r\n```{r,message=FALSE, warning=FALSE}\r\nmod.full<-brm(formula=Dieoff ~ \r\n#                AVRHUMID_MAX5D+\r\n                MAXRHUMID_MEAN5D+\r\n#                AVOFMINTEMP_5D_STGN+\r\n                DEWPAVMX_3D+\r\n#                MINTEMP_0D+\r\n#                MINTEMP_5D+\r\n                TOTPRECIP_5D+\r\n#                TOTPRECIP_10D+\r\n#                PRECIPDAYS_5D+\r\n#                PRECIPDAYS_10D+\r\n                MINTEMP_5D+\r\n#                AVOFMINTEMP_10D+\r\n#                AVOFMINTEMP_5D+\r\n#                DEWPAVMX_5D+\r\n#                MAXRHUMID_MEAN10D+\r\n#                MAXRHUMID_MEAN5D+\r\n                DIFFTEMP_3DAY+\r\n                SNOWANOM_MEAN_APRW1+\r\n#                NDVIANOM_MEAN_APRW3+\r\n                LAT+LON+(1|Year), data = seldat, \r\n                  family = bernoulli(link = \"logit\"), \r\n                  autocor=cor_arma(formula = ~Year),\r\n    prior = c(set_prior(\"normal(0,10)\", class = \"b\")), \r\n    warmup = 1000, iter = 2000, chains = 4,\r\n    control = list(adapt_delta = 0.95))\r\nsummary(mod.full)\r\n```\r\n\r\n\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}